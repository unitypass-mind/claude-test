<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íšŒì› ëŒ€ì‹œë³´ë“œ - FitLady</title>
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/member.css">
</head>
<body>
    <div class="member-dashboard">
        <!-- Member Header -->
        <header class="member-header">
            <div class="member-header-content">
                <div class="member-welcome">
                    <div class="member-avatar-large" id="memberAvatar">K</div>
                    <div class="member-greeting">
                        <h1 id="memberName">ì•ˆë…•í•˜ì„¸ìš”, íšŒì›ë‹˜!</h1>
                        <p id="membershipInfo">í™œì„± íšŒì›ê¶Œ: 3ê°œì›”ê¶Œ (D-45)</p>
                    </div>
                </div>

                <div class="header-actions">
                    <button class="header-btn" onclick="handleLogout()">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </div>
        </header>

        <!-- Member Navigation -->
        <nav class="member-nav">
            <div class="member-nav-content">
                <a href="#home" class="member-nav-item active" onclick="navigateToSection('home')">
                    í™ˆ
                </a>
                <a href="#attendance" class="member-nav-item" onclick="navigateToSection('attendance')">
                    ì¶œì„ ì²´í¬
                </a>
                <a href="#schedule" class="member-nav-item" onclick="navigateToSection('schedule')">
                    ì˜ˆì•½ ê´€ë¦¬
                </a>
                <a href="#myinfo" class="member-nav-item" onclick="navigateToSection('myinfo')">
                    ë‚´ ì •ë³´
                </a>
            </div>
        </nav>

        <!-- Member Content -->
        <div class="member-content">
            <!-- Home Section (ê¸°ë³¸) -->
            <div id="homeSection">
                <!-- Membership Card -->
                <div class="membership-card">
                    <div class="membership-content">
                        <div class="membership-header">
                            <div>
                                <div class="membership-type">3ê°œì›” íšŒì›ê¶Œ</div>
                                <h2 style="font-size: 24px; margin-top: 8px;" id="memberNameCard">ê¹€íšŒì›ë‹˜</h2>
                            </div>
                            <div class="membership-status">í™œì„±</div>
                        </div>

                        <div class="membership-info">
                            <div class="membership-info-item">
                                <h3>ì‹œì‘ì¼</h3>
                                <p id="startDate">2024-01-01</p>
                            </div>
                            <div class="membership-info-item">
                                <h3>ë§Œë£Œì¼</h3>
                                <p id="endDate">2024-04-01</p>
                            </div>
                            <div class="membership-info-item">
                                <h3>ë‚¨ì€ ê¸°ê°„</h3>
                                <p id="daysLeft">45ì¼</p>
                            </div>
                        </div>

                        <div class="membership-progress">
                            <div class="progress-label">
                                <span>ì´ìš© ê¸°ê°„</span>
                                <span id="progressPercent">50%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill" style="width: 50%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="quick-actions">
                    <a href="#" class="action-card" onclick="navigateToSection('attendance'); return false;">
                        <div class="action-icon">âœ“</div>
                        <h3 class="action-title">ì¶œì„ ì²´í¬</h3>
                        <p class="action-desc">ì˜¤ëŠ˜ì˜ ì¶œì„ì„ ì²´í¬í•˜ì„¸ìš”</p>
                    </a>

                    <a href="#" class="action-card" onclick="navigateToSection('schedule'); return false;">
                        <div class="action-icon">ğŸ“…</div>
                        <h3 class="action-title">ì˜ˆì•½í•˜ê¸°</h3>
                        <p class="action-desc">PT ë° ê°•ìŠµ ì˜ˆì•½</p>
                    </a>

                    <a href="#" class="action-card" onclick="navigateToSection('myinfo'); return false;">
                        <div class="action-icon">ğŸ‘¤</div>
                        <h3 class="action-title">ë‚´ ì •ë³´</h3>
                        <p class="action-desc">íšŒì› ì •ë³´ ì¡°íšŒ ë° ìˆ˜ì •</p>
                    </a>
                </div>

                <!-- Upcoming Schedule -->
                <div class="schedule-section">
                    <div class="section-header">
                        <h2 class="section-title">ë‹¤ê°€ì˜¤ëŠ” ì¼ì •</h2>
                        <button class="btn btn-outline btn-sm" onclick="navigateToSection('schedule')">
                            ì „ì²´ ë³´ê¸°
                        </button>
                    </div>

                    <div class="schedule-list" id="upcomingSchedules">
                        <div class="empty-state">
                            <div class="empty-icon">ğŸ“…</div>
                            <h3 class="empty-title">ì˜ˆì•½ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                            <p class="empty-desc">PTë‚˜ ê°•ìŠµì„ ì˜ˆì•½í•´ë³´ì„¸ìš”!</p>
                        </div>
                    </div>
                </div>

                <!-- Attendance Stats -->
                <div class="schedule-section">
                    <div class="section-header">
                        <h2 class="section-title">ì´ë²ˆ ë‹¬ ì¶œì„ í˜„í™©</h2>
                        <span class="text-secondary" id="attendanceCount">15íšŒ ì¶œì„</span>
                    </div>

                    <div class="attendance-grid" id="attendanceCalendar">
                        <!-- ì¶œì„ ìº˜ë¦°ë”ëŠ” JavaScriptë¡œ ìƒì„± -->
                    </div>
                </div>
            </div>

            <!-- Attendance Section -->
            <div id="attendanceSection" class="hidden">
                <div class="schedule-section">
                    <div class="section-header">
                        <h2 class="section-title">ì¶œì„ ì²´í¬</h2>
                    </div>

                    <div style="text-align: center; padding: 60px 20px;">
                        <div style="font-size: 80px; margin-bottom: 24px;">âœ“</div>
                        <h2 style="font-size: 28px; margin-bottom: 16px;">ì¶œì„ ì²´í¬</h2>
                        <p style="color: var(--color-text-secondary); margin-bottom: 32px;">
                            ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì˜¤ëŠ˜ì˜ ì¶œì„ì„ ì²´í¬í•˜ì„¸ìš”
                        </p>
                        <button class="btn btn-primary btn-lg" onclick="checkAttendance()">
                            ì¶œì„ ì²´í¬í•˜ê¸°
                        </button>
                        <div id="lastCheckIn" class="mt-lg text-secondary"></div>
                    </div>

                    <div class="section-header" style="margin-top: 48px;">
                        <h3>ì¶œì„ ê¸°ë¡</h3>
                    </div>
                    <p class="text-center text-secondary">ì¶œì„ ì²´í¬ ê¸°ëŠ¥ì€ member/attendance.jsì—ì„œ êµ¬í˜„ë©ë‹ˆë‹¤.</p>
                </div>
            </div>

            <!-- Schedule Section -->
            <div id="scheduleSection" class="hidden">
                <div class="schedule-section">
                    <div class="section-header">
                        <h2 class="section-title">ì˜ˆì•½ ê´€ë¦¬</h2>
                        <button class="btn btn-primary btn-sm">ìƒˆ ì˜ˆì•½</button>
                    </div>
                    <p class="text-center text-secondary">ì˜ˆì•½ ê´€ë¦¬ ê¸°ëŠ¥ì€ member/schedule.jsì—ì„œ êµ¬í˜„ë©ë‹ˆë‹¤.</p>
                </div>
            </div>

            <!-- My Info Section -->
            <div id="myinfoSection" class="hidden">
                <div class="schedule-section">
                    <div class="section-header">
                        <h2 class="section-title">ë‚´ ì •ë³´</h2>
                        <button class="btn btn-outline btn-sm">ì •ë³´ ìˆ˜ì •</button>
                    </div>

                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">ì´ë¦„</div>
                            <div class="info-value" id="infoName">ê¹€íšŒì›</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">ì—°ë½ì²˜</div>
                            <div class="info-value" id="infoPhone">010-1234-5678</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">ì´ë©”ì¼</div>
                            <div class="info-value" id="infoEmail">member@example.com</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">ìƒë…„ì›”ì¼</div>
                            <div class="info-value" id="infoBirthDate">1990-01-01</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">íšŒì› ë“±ë¡ì¼</div>
                            <div class="info-value" id="infoJoinDate">2024-01-01</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">íšŒì› ìƒíƒœ</div>
                            <div class="info-value">
                                <span class="badge badge-success">í™œì„±</span>
                            </div>
                        </div>
                    </div>

                    <p class="text-center text-secondary" style="margin-top: 40px;">
                        ìƒì„¸ ì •ë³´ ê´€ë¦¬ ê¸°ëŠ¥ì€ member/my-info.jsì—ì„œ êµ¬í˜„ë©ë‹ˆë‹¤.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast hidden" id="toast">
        <span class="toast-message"></span>
    </div>

    <script src="../js/config.js"></script>
    <script src="../js/utils.js"></script>
    <script src="../js/api.js"></script>
    <script src="../js/auth.js"></script>
    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¸ì¦ ì²´í¬
        if (!auth.checkPageAccess('member')) {
            // ë¦¬ë‹¤ì´ë ‰íŠ¸ ì²˜ë¦¬ëŠ” checkPageAccessì—ì„œ ìˆ˜í–‰
        }

        // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
        const user = auth.getCurrentUser();
        if (user) {
            document.getElementById('memberName').textContent = `ì•ˆë…•í•˜ì„¸ìš”, ${user.name}ë‹˜!`;
            document.getElementById('memberNameCard').textContent = `${user.name}ë‹˜`;
            document.getElementById('memberAvatar').textContent = user.name[0];

            // ë‚´ ì •ë³´ ì„¹ì…˜
            document.getElementById('infoName').textContent = user.name;
            document.getElementById('infoPhone').textContent = StringUtils.formatPhone(user.phone || '010-1234-5678');
            document.getElementById('infoEmail').textContent = user.email || 'member@example.com';
            document.getElementById('infoBirthDate').textContent = user.birthDate || '1990-01-01';
            document.getElementById('infoJoinDate').textContent = DateUtils.formatDate(user.joinDate || new Date());
        }

        // ì„¹ì…˜ ë„¤ë¹„ê²Œì´ì…˜
        function navigateToSection(section) {
            // ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            document.getElementById('homeSection').classList.add('hidden');
            document.getElementById('attendanceSection').classList.add('hidden');
            document.getElementById('scheduleSection').classList.add('hidden');
            document.getElementById('myinfoSection').classList.add('hidden');

            // ì„ íƒí•œ ì„¹ì…˜ í‘œì‹œ
            document.getElementById(section + 'Section').classList.remove('hidden');

            // ë„¤ë¹„ê²Œì´ì…˜ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.member-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event?.currentTarget?.classList.add('active');

            // í˜ì´ì§€ ìŠ¤í¬ë¡¤ ìµœìƒë‹¨ìœ¼ë¡œ
            window.scrollTo(0, 0);
        }

        // ì¶œì„ ì²´í¬
        function checkAttendance() {
            Toast.success('ì¶œì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
            const now = DateUtils.getNow();
            document.getElementById('lastCheckIn').textContent = `ë§ˆì§€ë§‰ ì¶œì„: ${now}`;
        }

        // ì¶œì„ ìº˜ë¦°ë” ìƒì„± (ìƒ˜í”Œ)
        function generateAttendanceCalendar() {
            const calendar = document.getElementById('attendanceCalendar');
            const daysInMonth = 31;
            const attendedDays = [1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 23, 25, 27, 29];

            let html = '';
            for (let i = 1; i <= daysInMonth; i++) {
                const isPresent = attendedDays.includes(i);
                html += `
                    <div class="attendance-day ${isPresent ? 'present' : 'absent'}">
                        <div class="day-number">${i}</div>
                    </div>
                `;
            }
            calendar.innerHTML = html;
        }

        // íšŒì›ê¶Œ ì§„í–‰ë¥  ê³„ì‚°
        function calculateMembershipProgress() {
            const startDate = new Date('2024-01-01');
            const endDate = new Date('2024-04-01');
            const today = new Date();

            const totalDays = DateUtils.getDaysBetween(startDate, endDate);
            const elapsedDays = DateUtils.getDaysBetween(startDate, today);
            const remainingDays = DateUtils.getDaysBetween(today, endDate);
            const progress = Math.round((elapsedDays / totalDays) * 100);

            document.getElementById('daysLeft').textContent = `${remainingDays}ì¼`;
            document.getElementById('progressPercent').textContent = `${progress}%`;
            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('membershipInfo').textContent =
                `í™œì„± íšŒì›ê¶Œ: 3ê°œì›”ê¶Œ (D-${remainingDays})`;
        }

        // ì´ˆê¸°í™”
        generateAttendanceCalendar();
        calculateMembershipProgress();
    </script>
</body>
</html>
