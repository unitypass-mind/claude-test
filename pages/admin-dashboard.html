<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ - FitLady</title>
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/admin.css">
</head>
<body>
    <div class="dashboard">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <span class="sidebar-logo-icon">ğŸ’ª</span>
                    <span>FitLady</span>
                </div>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">ë©”ì¸</div>
                    <a href="#dashboard" class="nav-item active" onclick="navigateTo('dashboard')">
                        <span class="nav-icon">ğŸ“Š</span>
                        <span>ëŒ€ì‹œë³´ë“œ</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">íšŒì› ê´€ë¦¬</div>
                    <a href="#members" class="nav-item" onclick="navigateTo('members')">
                        <span class="nav-icon">ğŸ‘¥</span>
                        <span>íšŒì› ëª©ë¡</span>
                    </a>
                    <a href="#payments" class="nav-item" onclick="navigateTo('payments')">
                        <span class="nav-icon">ğŸ’³</span>
                        <span>ê²°ì œ ê´€ë¦¬</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">ìš´ì˜ ê´€ë¦¬</div>
                    <a href="#attendance" class="nav-item" onclick="navigateTo('attendance')">
                        <span class="nav-icon">âœ“</span>
                        <span>ì¶œì„ ê´€ë¦¬</span>
                    </a>
                    <a href="#schedule" class="nav-item" onclick="navigateTo('schedule')">
                        <span class="nav-icon">ğŸ“…</span>
                        <span>ì¼ì • ê´€ë¦¬</span>
                    </a>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">A</div>
                    <div class="user-details">
                        <div class="user-name" id="userName">ê´€ë¦¬ì</div>
                        <div class="user-role">ê´€ë¦¬ì</div>
                    </div>
                    <button class="logout-btn" onclick="handleLogout()" title="ë¡œê·¸ì•„ì›ƒ">
                        ğŸšª
                    </button>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <button class="menu-toggle" id="menuToggle" onclick="toggleSidebar()">â˜°</button>
                <h1 class="page-title" id="pageTitle">ëŒ€ì‹œë³´ë“œ</h1>

                <div class="top-bar-actions">
                    <div class="search-box">
                        <span class="search-icon">ğŸ”</span>
                        <input
                            type="text"
                            class="search-input"
                            placeholder="íšŒì› ê²€ìƒ‰..."
                            id="searchInput"
                        >
                    </div>
                    <button class="notification-btn">
                        ğŸ””
                        <span class="notification-badge">3</span>
                    </button>
                </div>
            </div>

            <!-- Content Area -->
            <div class="content-area" id="contentArea">
                <!-- ëŒ€ì‹œë³´ë“œ ì»¨í…ì¸  (ê¸°ë³¸) -->
                <div id="dashboardContent">
                    <!-- Stats Cards -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-title">ì „ì²´ íšŒì›</div>
                                <div class="stat-icon">ğŸ‘¥</div>
                            </div>
                            <div class="stat-value" id="totalMembers">0</div>
                            <div class="stat-change positive">
                                <span>â†‘ 12%</span>
                                <span>ì§€ë‚œë‹¬ ëŒ€ë¹„</span>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-title">í™œì„± íšŒì›</div>
                                <div class="stat-icon">âœ“</div>
                            </div>
                            <div class="stat-value" id="activeMembers">0</div>
                            <div class="stat-change positive">
                                <span>â†‘ 8%</span>
                                <span>ì§€ë‚œë‹¬ ëŒ€ë¹„</span>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-title">ì´ë²ˆ ë‹¬ ë§¤ì¶œ</div>
                                <div class="stat-icon">ğŸ’°</div>
                            </div>
                            <div class="stat-value" id="monthlyRevenue">0ì›</div>
                            <div class="stat-change positive">
                                <span>â†‘ 15%</span>
                                <span>ì§€ë‚œë‹¬ ëŒ€ë¹„</span>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-title">ì˜¤ëŠ˜ ì¶œì„</div>
                                <div class="stat-icon">ğŸ“Š</div>
                            </div>
                            <div class="stat-value" id="todayAttendance">0</div>
                            <div class="stat-change">
                                <span>ì˜¤ëŠ˜ ì¶œì„í•œ íšŒì› ìˆ˜</span>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Members Table -->
                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">ìµœê·¼ ë“±ë¡ íšŒì›</h3>
                            <div class="table-actions">
                                <button class="btn btn-primary btn-sm" onclick="navigateTo('members')">
                                    ì „ì²´ ë³´ê¸°
                                </button>
                            </div>
                        </div>

                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ì´ë¦„</th>
                                    <th>ì—°ë½ì²˜</th>
                                    <th>íšŒì›ê¶Œ</th>
                                    <th>ë“±ë¡ì¼</th>
                                    <th>ìƒíƒœ</th>
                                </tr>
                            </thead>
                            <tbody id="recentMembersTable">
                                <tr>
                                    <td colspan="5" class="text-center">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ë‹¤ë¥¸ í˜ì´ì§€ ì»¨í…ì¸ ëŠ” JavaScriptë¡œ ë™ì  ë¡œë“œ -->
                <div id="membersContent" class="hidden"></div>
                <div id="paymentsContent" class="hidden"></div>
                <div id="attendanceContent" class="hidden"></div>
                <div id="scheduleContent" class="hidden"></div>
            </div>
        </main>
    </div>

    <!-- Toast -->
    <div class="toast hidden" id="toast">
        <span class="toast-message"></span>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay hidden" id="loadingOverlay">
        <div class="spinner"></div>
        <p>ë¡œë”© ì¤‘...</p>
    </div>

    <script src="../js/config.js"></script>
    <script src="../js/utils.js"></script>
    <script src="../js/api.js"></script>
    <script src="../js/auth.js"></script>
    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¸ì¦ ì²´í¬
        if (!auth.checkPageAccess('admin')) {
            // ë¦¬ë‹¤ì´ë ‰íŠ¸ ì²˜ë¦¬ëŠ” checkPageAccessì—ì„œ ìˆ˜í–‰
        }

        // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
        const user = auth.getCurrentUser();
        if (user) {
            document.getElementById('userName').textContent = user.name || 'ê´€ë¦¬ì';
            document.getElementById('userAvatar').textContent = (user.name || 'Admin')[0];
        }

        // ì‚¬ì´ë“œë°” í† ê¸€ (ëª¨ë°”ì¼)
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
        }

        // ë„¤ë¹„ê²Œì´ì…˜
        let currentView = 'dashboard';

        function navigateTo(view) {
            // ëª¨ë“  ì»¨í…ì¸  ìˆ¨ê¸°ê¸°
            document.getElementById('dashboardContent').classList.add('hidden');
            document.getElementById('membersContent').classList.add('hidden');
            document.getElementById('paymentsContent').classList.add('hidden');
            document.getElementById('attendanceContent').classList.add('hidden');
            document.getElementById('scheduleContent').classList.add('hidden');

            // ì„ íƒí•œ ì»¨í…ì¸  í‘œì‹œ
            const contentId = view + 'Content';
            const contentEl = document.getElementById(contentId);
            if (contentEl) {
                contentEl.classList.remove('hidden');
            }

            // ë„¤ë¹„ê²Œì´ì…˜ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event?.currentTarget?.classList.add('active');

            // í˜ì´ì§€ íƒ€ì´í‹€ ë³€ê²½
            const titles = {
                dashboard: 'ëŒ€ì‹œë³´ë“œ',
                members: 'íšŒì› ê´€ë¦¬',
                payments: 'ê²°ì œ ê´€ë¦¬',
                attendance: 'ì¶œì„ ê´€ë¦¬',
                schedule: 'ì¼ì • ê´€ë¦¬'
            };
            document.getElementById('pageTitle').textContent = titles[view] || 'ëŒ€ì‹œë³´ë“œ';

            currentView = view;

            // í•´ë‹¹ í˜ì´ì§€ ë°ì´í„° ë¡œë“œ
            loadViewData(view);

            // ëª¨ë°”ì¼ì—ì„œ ì‚¬ì´ë“œë°” ë‹«ê¸°
            if (window.innerWidth <= 1024) {
                document.getElementById('sidebar').classList.remove('active');
            }
        }

        // ë·° ë°ì´í„° ë¡œë“œ
        function loadViewData(view) {
            switch (view) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'members':
                    loadMembersData();
                    break;
                case 'payments':
                    loadPaymentsData();
                    break;
                case 'attendance':
                    loadAttendanceData();
                    break;
                case 'schedule':
                    loadScheduleData();
                    break;
            }
        }

        // ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ
        async function loadDashboardData() {
            // Mock ë°ì´í„°ë¡œ í‘œì‹œ
            document.getElementById('totalMembers').textContent = '156';
            document.getElementById('activeMembers').textContent = '142';
            document.getElementById('monthlyRevenue').textContent = NumberUtils.formatCurrency(12450000);
            document.getElementById('todayAttendance').textContent = '87';

            // ìµœê·¼ íšŒì› ë°ì´í„° (ìƒ˜í”Œ)
            const recentMembers = [
                { name: 'ê¹€ë¯¼ì§€', phone: '010-1234-5678', membership: '3ê°œì›”ê¶Œ', date: '2024-01-15', status: 'active' },
                { name: 'ì´ìˆ˜ì§„', phone: '010-2345-6789', membership: '1ê°œì›”ê¶Œ', date: '2024-01-14', status: 'active' },
                { name: 'ë°•ì§€ì€', phone: '010-3456-7890', membership: '6ê°œì›”ê¶Œ', date: '2024-01-13', status: 'active' }
            ];

            const tbody = document.getElementById('recentMembersTable');
            tbody.innerHTML = recentMembers.map(member => `
                <tr>
                    <td>${member.name}</td>
                    <td>${StringUtils.formatPhone(member.phone)}</td>
                    <td>${member.membership}</td>
                    <td>${member.date}</td>
                    <td><span class="badge badge-success">í™œì„±</span></td>
                </tr>
            `).join('');
        }

        function loadMembersData() {
            document.getElementById('membersContent').innerHTML = `
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">íšŒì› ëª©ë¡</h3>
                        <div class="table-actions">
                            <button class="btn btn-primary">íšŒì› ë“±ë¡</button>
                        </div>
                    </div>
                    <p class="text-center" style="padding: 40px;">íšŒì› ê´€ë¦¬ ê¸°ëŠ¥ì€ member-manage.jsì—ì„œ êµ¬í˜„ë©ë‹ˆë‹¤.</p>
                </div>
            `;
        }

        function loadPaymentsData() {
            document.getElementById('paymentsContent').innerHTML = `
                <p class="text-center" style="padding: 40px;">ê²°ì œ ê´€ë¦¬ ê¸°ëŠ¥ì€ payment-manage.jsì—ì„œ êµ¬í˜„ë©ë‹ˆë‹¤.</p>
            `;
        }

        function loadAttendanceData() {
            document.getElementById('attendanceContent').innerHTML = `
                <p class="text-center" style="padding: 40px;">ì¶œì„ ê´€ë¦¬ ê¸°ëŠ¥ì€ admin/attendance.jsì—ì„œ êµ¬í˜„ë©ë‹ˆë‹¤.</p>
            `;
        }

        function loadScheduleData() {
            document.getElementById('scheduleContent').innerHTML = `
                <p class="text-center" style="padding: 40px;">ì¼ì • ê´€ë¦¬ ê¸°ëŠ¥ì€ admin/schedule.jsì—ì„œ êµ¬í˜„ë©ë‹ˆë‹¤.</p>
            `;
        }

        // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
        loadDashboardData();
    </script>
</body>
</html>
